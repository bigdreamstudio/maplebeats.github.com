---
layout: post
author: maplebeats
title: 时间戳
summary: 在家上网，莫名其妙的开始出现上不了web.qq.com和github.com。抓包，看到了一些莫名其妙的RST，被纠结了好多天。今天终于在仙子的指导下，搞定了:)
tag: network RST 
---

h3. 问题

前段时间在本本上测试我的qq机器人，结果测着测着，突然就无法再连接上webqq了。感觉就像是网络出现问题了，而且因为只有webqq无法访问，就没在意。结果上台式机XP，发现网络一切正常。心中暗骂几句linux，然后开始抓包准备看看为啥，结果抓包结果才出来，准备分析的时候，KDE挂了！Xorg阵亡了= =，无奈只能reisub。一切恢复正常。
本来以为只是偶尔的情况，结果今天又遇见了= =。一朋友给我发github链接过来我发现github也上不了了！立马开wireshark抓之，发现了两种非常可疑的包。一个是本地发送到服务器的RST和服务器返回的有些包带有TCP Previous segment not captured。

h3. 解决

搜了几下，加上google被严重干扰，无奈。于是向群里求助，仙子说关闭时间戳。于是 
@sudo sysctl net.ipv4.tcp_timestamps=0@
@sudo sysctl -p@ 
把时间戳关闭。然后一切正常了。

h3. 后记

至于详细的原因，不懂，反正就是时间戳“不对”的包被内核丢弃了...反正按仙子的话说就是:“反正你知道啦，开机时间长点后如果 syn+ack 被本地 rst 的话可能是时间戳不对”。要了解详细的原因，还得去恶补一下《计算机网络》和《TCP/IP详解》。
至于为什么一部分网站能通，一部分又不行。我觉得是因为服务器方是否开启时间戳导致的，仙子说是ip地址问题。反正都有问题= =，一切的一切还得等我把那个900页的计算机网络啃完了再说55555555555555。

h3. PS

唉，又一次啥事也没干就把问题解决了。作为伸手党压力好大:(。花了一天时间把博客调整了，现在感觉还行。不过index页面还没做。毕设的问题也算是确定下来了，然后开始坐等过年吧。
